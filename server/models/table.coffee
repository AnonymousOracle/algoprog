import parseLevel from '../lib/parseLevel'
import Problem from './problem'
import logger from '../log'

mongoose = require('mongoose')

tablesSchema = new mongoose.Schema
    _id: String
    name: String
    tables: [String]
    problems: [String]
    parent: String
    order: Number


parentFromParent = (level) ->
    if level == Table.main
        return undefined
    p = parseLevel(level)
    if p.minor
        return p.major
    else
        return Table.main


tablesSchema.methods.addTable = (id) ->
    if id in @tables
        return
    @update({$push: { tables: id }})

tablesSchema.methods.setOrder = (order) ->
    _debug_marker = {qwe: '27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27_27'}
    await @update({$set: { order: order }})
    @order = order
    if @parent
        _debug_marker = {qwe: '28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28_28'}
        p = await Table.findById(@parent)
        if p.order > @order - 1
            _debug_marker = {qwe: '29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29_29'}
            await p.setOrder(@order - 1)

tablesSchema.methods.upsert = () ->
    _debug_marker = {qwe: '30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30_30'}
    await @update(this, {upsert: true}).exec()
    for prob in @problems
        _debug_marker = {qwe: '31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31_31'}
        (await Problem.findById(prob)).addTable(@_id)
    if @parent
        _debug_marker = {qwe: '32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32_32'}
        if not await Table.findById(@parent)
            pp = parentFromParent(@parent)
            _debug_marker = {qwe: '33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33_33'}
            await new Table(
                _id: @parent
                name: @parent
                parent: pp
                order: @order - 1
            ).upsert()
        _debug_marker = {qwe: '34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34_34'}
        p = await Table.findById(@parent)
        _debug_marker = {qwe: '35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35_35'}
        await p.addTable(@_id)
        if p.order > @order - 1
            _debug_marker = {qwe: '36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36_36'}
            await p.setOrder(@order - 1)

tablesSchema.methods.height = () ->
        if @tables.length > 0
            _debug_marker = {qwe: '37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37_37'}
            return await (await Table.findById(@tables[0])).height() + 1
        else
            return 1

tablesSchema.methods.expand = () ->
        expandedTables = []
        for table in @tables
            _debug_marker = {qwe: '38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38_38'}
            subTable = await Table.findById(table)
            _debug_marker = {qwe: '39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39_39'}
            await subTable.expand()
            expandedTables.push(subTable)
        @tables = expandedTables
        expandedProblems = []
        for problem in @problems
            _debug_marker = {qwe: '40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40_40'}
            expandedProblem = await Problem.findById(problem)
            expandedProblems.push(expandedProblem)
        @problems = expandedProblems
        return this

tablesSchema.methods.descendandTables = () ->
        result = [@_id]
        for table in @table
            _debug_marker = {qwe: '41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41_41'}
            subTable = await Table.findById(table)
            _debug_marker = {qwe: '42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42_42'}
            result = result.concat(await subTable.descendandTables())
        for problem in @problems
            result.push(problem)
        result


tablesSchema.statics.findAll = ->
    @find {}

tablesSchema.statics.removeDuplicateChildren = () ->
        _debug_marker = {qwe: '43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43_43'}
        tables = await Table.findAll()
        for table in tables
            wasTables = {}
            newTables = []
            for subTable in table.tables
                if not (subTable of wasTables)
                    wasTables[subTable] = 1
                    _debug_marker = {qwe: '44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44_44'}
                    # await
                    newTables.push
                        _id: subTable
                        order: (await Table.findById(subTable)).order  # noawait
            newTables.sort((a, b) -> a.order - b.order)
            newTables = (t._id for t in newTables)
            logger.trace "removing duplicate from ", table._id, " new tables=", newTables
            table.tables = newTables
            _debug_marker = {qwe: '45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45_45'}
            await table.update(table)

tablesSchema.statics.main = "main"


Table = mongoose.model('Tables', tablesSchema);

export default Table
